---
title: "Prediction Tunning"
author: "Gustavo Monteiro"
date: "November 2, 2018"
output:
  pdf_document:
    toc: yes
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
library(readr)
library(here)
library(caret)
library(dplyr)
library(recipes)
library(ggplot2)
```

```{r}
read_csv(
  here('./train.csv'), 
  local= locale("br"),
  col_types = cols(
    ano = col_integer(), # ano de referencia
    sequencial_candidato = col_character(), # id do candidato
    quantidade_doacoes = col_integer(),
    quantidade_doadores = col_integer(), # número de doadores diferentes
    total_receita = col_double(), # soma em R$ das doações
    media_receita = col_double(), # média das doações
    recursos_de_outros_candidatos.comites = col_double(), # quantia em R$ das doações provenientes de outros candidatos ou comite partidário
    recursos_de_pessoas_fisicas = col_double(), # quantia em R$ das doações provenientes de outros CPFs
    recursos_de_pessoas_juridicas = col_double(), # quantia em R$ das doações provenientes de outros CNPJ
    recursos_proprios = col_double(), # quantia em R$ das doações provenientes do próprio candidato
    `recursos_de_partido_politico` = col_double(), # quantia em R$ das doações provenientes do partido político do candidato
    quantidade_despesas = col_integer(),
    quantidade_fornecedores = col_integer(), # número de fornecedores/despesas diferentes
    total_despesa = col_double(), # soma em R$ das despesas de campanha
    media_despesa = col_double(), # média das despesas de campanha
    votos = col_integer(), #  variável alvo. Se refere ao número de votos na campanha de 2006 ou 2010
    .default = col_character())) -> treino

teste <- read.csv("./test.csv")

treino <- treino %>% select (-cargo)
teste <- teste %>% select (-cargo)
```

```{r}
fitControl <- trainControl(method = "boot")
preProcValues <- c("center", "scale")
```

```{r}
set.seed(1)

rctrl1 <- trainControl(method = "cv", number = 10, returnResamp = "all")
m.ridge <- train(votos ~ quantidade_doadores + quantidade_doadores, data = treino, 
                          method = "ridge", trControl = rctrl1, tuneLenght = 10)

set.seed(849)
m.lasso <- train(votos ~ total_despesa + quantidade_doadores, data = treino, tuneLength = 100,
                          method = "lasso", trControl = rctrl1,
                          preProc = c("center", "scale"))


ggplot(m.lasso)
m.lasso$results
test_lasso <- predict(m.lasso, teste)
test_lasso

set.seed(849)
m.knn <- train(votos ~ total_despesa, data = treino, method = "knn", 
               preProc = c("center", "scale"), tuneLength = 100)
test_knn <- predict(m.knn, teste)
ggplot(m.knn)
test_knn
m.knn$results
```